<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AI Data-Center Power Contracts Tracker</title>
<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, sans-serif; margin: 24px; }
  h1 { margin-bottom: 8px; }
  .meta { color: #555; margin-bottom: 16px; }
  .controls { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; margin-bottom: 12px; }
  input[type="search"] { padding: 8px 10px; border: 1px solid #ccc; border-radius: 6px; min-width: 240px; }
  table { width: 100%; border-collapse: collapse; }
  th, td { text-align: left; padding: 10px; border-bottom: 1px solid #eee; vertical-align: top; }
  th { position: sticky; top: 0; background: #fafafa; cursor: pointer; }
  tr:hover td { background: #fcfcff; }
  .hint { font-size: 12px; color: #666; }
</style>
</head>
<body>
  <h1>AI Data-Center Power Contracts Tracker</h1>
  <div class="meta">Public, auto-loaded from CSV. Click headers to sort. Use search to filter rows.</div>

  <div class="controls">
    <input id="search" type="search" placeholder="Search company, buyer, region, technologyâ€¦" aria-label="Search">
    <span class="hint">Tip: sort by clicking any column header.</span>
  </div>

  <table id="tracker">
    <thead></thead>
    <tbody></tbody>
  </table>

  <!-- Papa Parse to read CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
  // ðŸ”§ Your CSV file (raw URL)
  const CSV_URL = "https://raw.githubusercontent.com/visheshbajpai25/AI-DC-Power-Tracker/main/data/ai_dc_power_contracts_tracker_expanded.csv";
  const FETCH_URL = CSV_URL + "?v=" + Date.now(); // cache-buster

  // Column order to render (must match CSV headers)
  const COLUMNS = [
    "Company",
    "Total Contracted (MW/GW)",
    "Buyer / Counterparty",
    "Counterparty Type",
    "Region",
    "Market / ISO",
    "Technology",
    "Contract Structure",
    "Term (Years)",
    "Status",
    "In-Service (Announced)",
    "Notes"
  ];

  const table = document.getElementById("tracker");
  const thead = table.createTHead();
  const tbody = table.tBodies[0] || table.createTBody();

  function renderHeader() {
    const tr = document.createElement("tr");
    COLUMNS.forEach(col => {
      const th = document.createElement("th");
      th.textContent = col;
      th.style.cursor = "pointer";
      th.addEventListener("click", () => sortBy(col));
      tr.appendChild(th);
    });
    thead.innerHTML = "";
    thead.appendChild(tr);
  }

  let rows = [];
  let sortState = { key: null, dir: 1 };

  function renderBody(data) {
    const frag = document.createDocumentFragment();
    data.forEach(r => {
      const tr = document.createElement("tr");
      COLUMNS.forEach(col => {
        const td = document.createElement("td");
        td.textContent = r[col] ?? "";
        tr.appendChild(td);
      });
      frag.appendChild(tr);
    });
    tbody.innerHTML = "";
    tbody.appendChild(frag);
  }

  function numericCandidate(v) {
    const s = String(v ?? "").replace(/[^0-9.\-]/g,"");
    const n = parseFloat(s);
    return isNaN(n) ? null : n;
  }

  function sortBy(col) {
    if (sortState.key === col) sortState.dir *= -1;
    else { sortState.key = col; sortState.dir = 1; }
    const dir = sortState.dir;

    const sorted = rows.slice().sort((a,b) => {
      const av = a[col] ?? "", bv = b[col] ?? "";
      const an = numericCandidate(av), bn = numericCandidate(bv);
      let cmp = 0;
      if (an !== null && bn !== null) cmp = an - bn;
      else cmp = String(av).localeCompare(String(bv), undefined, { sensitivity: "base" });
      return dir > 0 ? cmp : -cmp;
    });
    renderBody(sorted);
  }

  function attachSearch() {
    const q = document.getElementById("search");
    if (!q) return;
    q.addEventListener("input", () => {
      const term = q.value.trim().toLowerCase();
      const filtered = term
        ? rows.filter(r => COLUMNS.some(c => String(r[c] ?? "").toLowerCase().includes(term)))
        : rows;
      renderBody(filtered);
    });
  }

  function loadCSV() {
    Papa.parse(FETCH_URL, {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: (res) => {
        rows = res.data.map(r => {
          const o = {};
          COLUMNS.forEach(c => o[c] = r[c] ?? r[c?.trim()] ?? "");
          return o;
        });
        renderHeader();
        renderBody(rows);
      },
      error: (err) => {
        console.error("CSV load error", err);
        tbody.innerHTML = `<tr><td colspan="${COLUMNS.length}">Failed to load CSV. Check CSV_URL and repo visibility.</td></tr>`;
      }
    });
  }

  attachSearch();
  loadCSV();
  </script>
</body>
</html>
